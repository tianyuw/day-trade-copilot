# é¡¹ç›®ææ¡ˆï¼š0DTE Copilot (v1.3)

## 1. é¡¹ç›®æ¦‚è§ˆ
0DTE Copilot æ˜¯ä¸€ä¸ªæ™ºèƒ½è‚¡ç¥¨ç›‘æ§ç³»ç»Ÿï¼Œæ—¨åœ¨é€šè¿‡å®æ—¶åˆ†æ 1 åˆ†é’Ÿ K çº¿å›¾æ¥è¾…åŠ©äº¤æ˜“è€…ã€‚ç³»ç»Ÿé‡‡ç”¨**â€œé‡åŒ–ç­›é€‰ + AI éªŒè¯â€**çš„åŒå±‚æ¶æ„ï¼šé¦–å…ˆåˆ©ç”¨é«˜æ•ˆçš„é‡åŒ–æŒ‡æ ‡ç®—æ³• (Z-Score Momentum) å®æ—¶æ‰«ææ½œåœ¨çš„çªç ´ç‚¹ä½ï¼Œä¸€æ—¦æ£€æµ‹åˆ°ä¿¡å·ï¼Œç«‹å³è°ƒç”¨ **Gemini 3 Pro** çš„å¤šæ¨¡æ€èƒ½åŠ›è¿›è¡Œæ·±åº¦éªŒè¯ï¼Œç¡®è®¤çªç ´çš„çœŸå®æ€§å’Œæœ‰æ•ˆæ€§ï¼Œä»è€Œæä¾›é«˜èƒœç‡çš„å¯æ‰§è¡Œäº¤æ˜“ä¿¡å·ã€‚

*v1.3 ç‰ˆæœ¬æ ¸å¿ƒå˜æ›´ï¼šå¼•å…¥äº† Pine Script é‡åŒ–ç®—æ³•ä½œä¸ºä¸€çº§è¿‡æ»¤å™¨ï¼Œå°† AI çš„è§’è‰²ä»â€œæ¯åˆ†é’Ÿå·¡æ£€â€è½¬å˜ä¸ºâ€œæŒ‰éœ€éªŒè¯â€ï¼Œæ˜¾è‘—é™ä½æˆæœ¬å¹¶æé«˜ä¿¡å·è´¨é‡ã€‚*

## 2. æ ¸å¿ƒå·¥ä½œæµ

### 2.1 ç¬¬ä¸€å±‚ï¼šé‡åŒ–ç­›é€‰ (Quant Filter)
- **æ ¸å¿ƒç®—æ³•**: åŸºäº Pine Script é€»è¾‘çš„ Z-Score Momentum Breakout ç­–ç•¥ã€‚
  - **è„šæœ¬è·¯å¾„**: `/Users/tianyuwang/Projects/odte-copilot/pine_scripts/zscore_momentum_breakout.pine`
  - **é€»è¾‘**: è®¡ç®—ä»·æ ¼ç›¸å¯¹äºè¿‡å» 30 å¤©æ—¥çº¿å‡å€¼çš„ Z-Scoreï¼Œå¹¶ç›‘æ§å…¶åŠ¨é‡å˜åŒ– (Diff)ã€‚å½“ Diff çªç ´é˜ˆå€¼æ—¶ï¼Œæ ‡è®°ä¸ºæ½œåœ¨çªç ´ç‚¹ã€‚
- **è¿è¡Œæœºåˆ¶**: å¯¹ç»™å®šçš„è‚¡ç¥¨åˆ—è¡¨ï¼Œç³»ç»Ÿå®æ—¶è¿è¡Œè¯¥ç®—æ³•ï¼ŒæŒç»­ç›‘æ§æ¯ä¸€åˆ†é’Ÿçš„ K çº¿æ”¶ç›˜çŠ¶æ€ã€‚
- **è§¦å‘**: åªæœ‰å½“ç®—æ³•æ£€æµ‹åˆ°æ˜ç¡®çš„â€œæ½œåœ¨çªç ´ä¿¡å·â€æ—¶ï¼Œæ‰ä¼šæ¿€æ´»ç¬¬äºŒå±‚ AI éªŒè¯ã€‚

### 2.2 ç¬¬äºŒå±‚ï¼šAI æ·±åº¦éªŒè¯ (AI Verification)
ä¸€æ—¦é‡åŒ–å±‚å‘å‡ºä¿¡å·ï¼Œç³»ç»Ÿç«‹å³å‘ **Gemini 3 Pro** å‘èµ·è¯·æ±‚ï¼Œè¿›è¡Œå¤šæ¨¡æ€éªŒè¯ã€‚
- **è¾“å…¥æ•°æ®**:
  1. **å¸‚åœºæ•°æ®**: è¿‡å» 30 åˆ†é’Ÿçš„ OHLCV åºåˆ—ã€‚
  2. **æŠ€æœ¯æŒ‡æ ‡**: è¿‡å» 30 åˆ†é’Ÿçš„ EMA9, EMA21, Volume, VWAP, Bollinger Bands åºåˆ—ã€‚
  3. **æœŸæƒé“¾æ•°æ® (Option Chain)**: å½“å‰æ—¶åˆ»æ‰€æœ‰ç›¸å…³æœŸæƒåˆçº¦çš„å®Œæ•´æ•°æ®å¿«ç…§ï¼ˆåŒ…æ‹¬ Strike Price, Expiration Date, Bid/Ask, Volume, Open Interest, Delta, Gamma, Theta, Vegaï¼‰ã€‚è¿™å°†ä½¿ LLM èƒ½å¤ŸåŸºäºçœŸå®çš„æµåŠ¨æ€§å’Œå®šä»·æ¥é€‰æ‹©æœ€ä½³åˆçº¦ã€‚
  4. **ä¸Šä¸‹æ–‡è®°å¿†**: åŠ¨æ€æ›´æ–°çš„æ»šåŠ¨æ‘˜è¦ (Rolling Summary) å’Œå…³é”®å¸§ (Keyframes)ã€‚
  5. **è§†è§‰æ•°æ®**: ç”Ÿæˆçš„ K çº¿å›¾å›¾ç‰‡ï¼Œå åŠ æŒ‡æ ‡åŠé‡åŒ–ç®—æ³•æ ‡è®°å‡ºçš„çªç ´ç‚¹ä½ã€‚
- **éªŒè¯ä»»åŠ¡**: ç¡®è®¤è¯¥ç‚¹ä½æ˜¯å¦æ˜¯åˆé€‚çš„0DTEä¹°ç‚¹ï¼Œä¹°å…¥çš„ç¡®ä¿¡åº¦æœ‰å¤šå¤§ã€‚åŒæ—¶ç»™å‡ºå…·ä½“çš„ç†ç”±ã€‚ä¹Ÿç»™å‡ºå…·ä½“çš„æ“ä½œè®¡åˆ’ï¼Œè®¡åˆ’åº”è¯¥åŒ…æ‹¬: ä¹°callè¿˜æ˜¯putï¼Œè¡Œæƒä»·ï¼ŒæœŸæƒæ­¢æŸä»·æ ¼ï¼Œæ­¢ç›ˆä»·æ ¼ã€‚

### 2.3 ç»“æ„åŒ–é¢„æµ‹è¾“å‡ºä¸é£æ§
LLM å¿…é¡»è¿”å›ä¸¥æ ¼çš„ **JSON æ ¼å¼** æ•°æ®ã€‚
**ç¤ºä¾‹ JSON Payload**:
```json
{
  "is_valid_buy_point": true,
  "confidence": 0.92,
  "reasoning": "Volume surge confirms the Z-score breakout; price is closing above upper Bollinger Band.",
  "action_plan": {
    "option_type": "call",
    "strike_price": 346.00,
    "option_stop_loss": 1.20,
    "option_take_profit": 2.50,
    "underlying_trigger_price": 345.50
  }
}
```

### 2.4 å®æ—¶æ‰§è¡Œç›‘æ§
- **ç­–ç•¥ç¼“å­˜ (Strategy Cache)**: å­˜å‚¨ AI éªŒè¯é€šè¿‡çš„æœ‰æ•ˆç­–ç•¥ã€‚
- **æ‰§è¡Œé€»è¾‘**: 
  - åªæœ‰å½“ `is_valid_buy_point` ä¸º `true` ä¸”ç½®ä¿¡åº¦è¾¾æ ‡æ—¶ï¼Œç­–ç•¥æ‰ä¼šè¢«æ¨é€åˆ°ç¼“å­˜ã€‚
  - ç‹¬ç«‹çš„ç§’çº§ç›‘æ§è¿›ç¨‹è½®è¯¢ç¼“å­˜ï¼Œå½“å®æ—¶ä»·æ ¼æ»¡è¶³ `underlying_trigger_price` æ¡ä»¶æ—¶ï¼Œè§¦å‘æœ€ç»ˆçš„ç”¨æˆ·è­¦æŠ¥ã€‚

## 3. æ•°æ®åŸºç¡€è®¾æ–½
- **æä¾›å•†**: [Alpaca Market Data API](https://docs.alpaca.markets/docs/about-market-data-api)
- **æŠ€æœ¯**: WebSocket & REST APIã€‚
- **æ•°æ®æµ**:
  - **å†å²æ•°æ® (REST)**: ç”¨äºå›æ”¾æ¨¡å¼å’Œåˆå§‹åŒ–è®¡ç®—ã€‚
  - **å®æ—¶æ•°æ® (WebSocket)**: 
    - **IEX/SIP Feeds**: ç”¨äºé©±åŠ¨ç¬¬ä¸€å±‚é‡åŒ–ç­›é€‰ç®—æ³•å’Œå®æ—¶æ‰§è¡Œç›‘æ§ã€‚

## 4. ç³»ç»Ÿæ¶æ„
1. **æ•°æ®æ‘„å–å±‚**: ç®¡ç†ä¸ Alpaca çš„ WebSocket è¿æ¥ä»¥åŠ REST API è¯·æ±‚ã€‚
2. **é‡åŒ–å¼•æ“ (Quant Engine)**: 
   - å®æ—¶è¿è¡Œ Python é‡å†™ç‰ˆçš„ `zscore_momentum_breakout` é€»è¾‘ã€‚
   - å……å½“ç³»ç»Ÿçš„â€œå®ˆé—¨å‘˜â€ï¼Œè¿‡æ»¤æ‰ç»å¤§å¤šæ•°æ— æ•ˆæ³¢åŠ¨ã€‚
3. **å¤„ç†å±‚**:
   - ä»…åœ¨è§¦å‘æ—¶è®¡ç®—å¤æ‚æŒ‡æ ‡ã€æ¸²æŸ“å›¾è¡¨ã€‚
   - ç®¡ç†ä¸Šä¸‹æ–‡è®°å¿†ã€‚
4. **AI ç¼–æ’å™¨**: æ¥æ”¶é‡åŒ–å¼•æ“çš„è§¦å‘ä¿¡å·ï¼Œè°ƒç”¨ Gemini 3 Proã€‚
5. **ç­–ç•¥ç¼“å­˜ (Strategy Cache)**: å­˜å‚¨éªŒè¯åçš„é«˜ç½®ä¿¡åº¦ç­–ç•¥ã€‚
6. **ä¿¡å·ç›‘æ§å™¨**: æ‰§è¡Œç§’çº§ä»·æ ¼æ¯”å¯¹ä¸è­¦æŠ¥ã€‚
7. **Web åº”ç”¨**: æä¾›ç”¨æˆ·äº¤äº’ç•Œé¢ã€‚

## 5. ç”¨æˆ·ç•Œé¢ (Web App)

### 5.1 æ¦‚è§ˆ
- ä¸€ä¸ªåŸºäº Web çš„å•é¡µåº”ç”¨ (SPA)ã€‚
- **è½åœ°é¡µ (Landing Page)**: ç®€å•çš„å…¥å£é¡µé¢ï¼Œç‚¹å‡»å³å¯è¿›å…¥æ ¸å¿ƒçš„è‚¡ç¥¨æ™ºèƒ½ç›‘æ§é¢æ¿ã€‚

### 5.2 ç›‘æ§é¢æ¿ (Dashboard)
![Dashboard Mockup](../resources/image.png)
- **å¸ƒå±€**: é‡‡ç”¨ç½‘æ ¼å¸ƒå±€ (Grid)ï¼Œæ¯è¡Œæ˜¾ç¤º 3 ä¸ªå›¾è¡¨å¡ç‰‡ã€‚
- **å›¾è¡¨å†…å®¹**:
  - æ˜¾ç¤ºè‚¡ç¥¨çš„ **1åˆ†é’Ÿ K çº¿å›¾**ã€‚
  - **å åŠ æŠ€æœ¯æŒ‡æ ‡**: EMA9, EMA21, Bollinger Bands, VWAPã€‚
  - å›¾è¡¨æ”¯æŒå®æ—¶åŠ¨æ€åˆ·æ–°ã€‚

### 5.3 æ™ºèƒ½æ’åºä¸çŠ¶æ€æŒ‡ç¤º
åˆ—è¡¨ä¸­çš„è‚¡ç¥¨å¡ç‰‡ä¼šæ ¹æ®ä¿¡å·çŠ¶æ€è‡ªåŠ¨æ’åºå’Œæ ‡è®°ï¼š
1.  **AI æ·±åº¦éªŒè¯é€šè¿‡ (æœ€é«˜ä¼˜å…ˆçº§)**:
    - **æ’åº**: è‡ªåŠ¨ç½®é¡¶ï¼Œæ’åœ¨åˆ—è¡¨æœ€å‰é¢ã€‚å¦‚æœå¤šä¸ªè‚¡ç¥¨æ»¡è¶³ï¼ŒæŒ‰æœ€æ–°è§¦å‘æ—¶é—´æ’åºã€‚
    - **è§†è§‰æ•ˆæœ**: æ˜¾ç¤ºé—ªçƒçš„ ğŸ”¥ (Fire) å›¾æ ‡ï¼Œè¡¨ç¤ºæé«˜å…³æ³¨åº¦ã€‚**æŒç»­æ—¶é—´é»˜è®¤ä¸º 2 åˆ†é’Ÿ**ã€‚å½“ 2 åˆ†é’Ÿå€’è®¡æ—¶ç»“æŸæˆ–åŸºç¡€é‡åŒ–ä¿¡å·æ¶ˆå¤±æ—¶ï¼Œè¯¥çŠ¶æ€è‡ªåŠ¨å–æ¶ˆã€‚
2.  **é‡åŒ–ç­›é€‰é€šè¿‡ (æ¬¡é«˜ä¼˜å…ˆçº§)**:
    - **æ’åº**: æ’åœ¨ AI éªŒè¯é€šè¿‡çš„è‚¡ç¥¨ä¹‹åï¼Œæ™®é€šè‚¡ç¥¨ä¹‹å‰ã€‚
    - **è§†è§‰æ•ˆæœ**: æ˜¾ç¤ºé—ªçƒçš„ âš¡ï¸ (Lightning) æˆ–ç±»ä¼¼å›¾æ ‡ï¼Œè¡¨ç¤ºæ½œåœ¨æœºä¼šã€‚**æŒç»­æ—¶é—´é»˜è®¤ä¸º 2 åˆ†é’Ÿ**ã€‚
3.  **æ™®é€šçŠ¶æ€**:
    - **æ’åº**: æŒ‰ç…§é»˜è®¤é¡ºåºï¼ˆå¦‚ Ticker å­—æ¯åºï¼‰æ’åˆ—åœ¨æœ€åã€‚

**çŠ¶æ€è”åŠ¨æœºåˆ¶**:
- é‡åŒ–ç­›é€‰ä¿¡å·æ˜¯ AI éªŒè¯ä¿¡å·çš„**å‰ç½®æ¡ä»¶**ã€‚
- å¦‚æœé‡åŒ–ç­›é€‰ä¿¡å·æ¶ˆå¤±ï¼ˆå³ 2 åˆ†é’Ÿæœ‰æ•ˆæœŸç»“æŸï¼‰ï¼Œé‚£ä¹ˆå³ä½¿ AI éªŒè¯é€šè¿‡çš„ ğŸ”¥ çŠ¶æ€è¿˜æœªåˆ°æœŸï¼Œä¹Ÿä¼š**å¼ºåˆ¶åŒæ­¥æ¶ˆå¤±**ï¼Œå›¾è¡¨å›å½’æ™®é€šçŠ¶æ€ã€‚è¿™ç¡®ä¿äº†ç”¨æˆ·ä¸ä¼šçœ‹åˆ°è¿‡æ—¶çš„æ¨èã€‚

### 5.4 è¿è¡Œæ¨¡å¼
é¡µé¢æ”¯æŒä¸¤ç§æ¨¡å¼åˆ‡æ¢ï¼š
1.  **å›æ”¾æ¨¡å¼ (Playback Mode) [ä¼˜å…ˆå®ç°]**:
    - ç”¨æˆ·è¾“å…¥ä¸€ä¸ªè¿‡å» 30 å¤©å†…çš„æ—¶é—´ç‚¹ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰ã€‚
    - ç³»ç»Ÿä»è¯¥æ—¶é—´ç‚¹å¼€å§‹ï¼Œæ¨¡æ‹ŸçœŸå®çš„æ—¶é—´æµé€ï¼Œé‡æ”¾å†å²æ•°æ®ã€‚
    - åœ¨å›æ”¾è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šåŒæ­¥æ‰§è¡Œé‡åŒ–ç­›é€‰å’Œ AI éªŒè¯é€»è¾‘ï¼Œå¤ç°å½“æ—¶å¯èƒ½äº§ç”Ÿçš„ä¿¡å·å’Œå›¾è¡¨æ’åºå˜åŒ–ã€‚
2.  **å®æ—¶æ¨¡å¼ (Real-time Mode)**:
    - è¿æ¥ Alpaca WebSocketï¼Œå±•ç¤ºæœ€æ–°çš„å¸‚åœºå®å†µã€‚

## 6. æŠ€æœ¯å®ç°ç»†èŠ‚ (Technical Details)

### 6.1 æŠ€æœ¯æ ˆ (Tech Stack)
- **Frontend**:
  - **Framework**: React.js / Next.js
  - **Charting Library**: Lightweight Charts (by TradingView) - é«˜æ€§èƒ½ï¼Œé€‚åˆå®æ—¶é‡‘èå›¾è¡¨ã€‚
  - **UI Library**: Tailwind CSS + ShadcnUI
  - **State Management**: Zustand / React Query
- **Backend**:
  - **Language**: Python 3.10+
  - **Web Framework**: FastAPI (é«˜æ€§èƒ½å¼‚æ­¥æ¡†æ¶ï¼Œé€‚åˆ WebSocket)ã€‚
  - **Task Queue**: Celery + Redis (å¤„ç†è€—æ—¶çš„ AI æ¨ç†ä»»åŠ¡)ã€‚
  - **Data Processing**: Pandas / TA-Lib (æŠ€æœ¯æŒ‡æ ‡è®¡ç®—)ã€‚
- **Database**:
  - **Time-series**: In-memory (Pandas DataFrame) for realtime window; Optional: TimescaleDB / InfluxDB for persistence.
  - **Cache**: Redis (Strategy Cache, Quant Signals).

### 6.2 å…³é”®æ¨¡å—å®ç°

#### A. é‡åŒ–å¼•æ“ (Quant Engine)
- **å®ç°æ–¹å¼**: ç‹¬ç«‹è¿è¡Œçš„ Python è¿›ç¨‹æˆ– Asyncio Taskã€‚
- **é€»è¾‘**: ç»´æŠ¤ä¸€ä¸ª `Symbol -> DataFrame` çš„å†…å­˜æ˜ å°„ã€‚
- **æ•°æ®æµ**: è®¢é˜… Alpaca WebSocket -> æ”¶åˆ° Bar -> æ›´æ–° DataFrame -> è®¡ç®— Z-Score -> åˆ¤æ–­ Diff -> **å†™å…¥ Redis** (Key: `signal:quant:{symbol}`, TTL: 120s)ã€‚

#### B. AI ç¼–æ’å™¨ (AI Orchestrator)
- **è§¦å‘**: ç›‘å¬ Redis KeySpace Notification æˆ– è½®è¯¢ Redis ä¸­çš„é‡åŒ–ä¿¡å·ã€‚
- **æ‰§è¡Œ**:
  1. å¹¶å‘è·å– Option Chain Snapshot (IO Bound)ã€‚
  2. ç”Ÿæˆ K çº¿å›¾ (CPU Bound, ä½¿ç”¨ `mplfinance` æˆ–ç±»ä¼¼åº“)ã€‚
  3. è°ƒç”¨ Gemini APIã€‚
  4. ç»“æœå†™å…¥ Redis (Key: `signal:ai:{symbol}`, TTL: 120s)ã€‚

#### C. å‰åç«¯é€šä¿¡
- **WebSocket**: å‰ç«¯ä¸ FastAPI å»ºç«‹é•¿è¿æ¥ã€‚
- **Payload**: åç«¯å®šæ—¶æ¨é€ï¼ˆæˆ–å˜åŒ–æ—¶æ¨é€ï¼‰å…¨é‡è‚¡ç¥¨çŠ¶æ€åˆ—è¡¨ï¼ŒåŒ…å«ï¼š
  - æœ€æ–°ä»·æ ¼/Kçº¿
  - `quant_signal_status` (Boolean)
  - `ai_signal_status` (Boolean)
  - `ai_reasoning` (String)
- **æ’åºé€»è¾‘**: å‰ç«¯æ ¹æ®çŠ¶æ€å­—æ®µåœ¨æœ¬åœ°è¿›è¡Œ Sortï¼Œå®ç°æ— é—ªçƒçš„åˆ—è¡¨é‡æ’ã€‚
